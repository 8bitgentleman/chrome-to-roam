(()=>{"use strict";var t={d:(e,n)=>{for(var r in n)t.o(n,r)&&!t.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:n[r]})},o:(t,e)=>Object.prototype.hasOwnProperty.call(t,e)},e={};t.d(e,{$C:()=>T,CT:()=>k,D4:()=>y,DM:()=>b,Df:()=>w,Gc:()=>v,T$:()=>m,X4:()=>p,j4:()=>f,pe:()=>g,q:()=>l});var n,r,o,i,a,c=function(t,e,n,r){return new(n||(n=Promise))((function(o,i){function a(t){try{s(r.next(t))}catch(t){i(t)}}function c(t){try{s(r.throw(t))}catch(t){i(t)}}function s(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,c)}s((r=r.apply(t,e||[])).next())}))},s=function(t,e,n,r,o){if("m"===r)throw new TypeError("Private method is not writable");if("a"===r&&!o)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?t!==e||!o:!e.has(t))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===r?o.call(t,n):o?o.value=n:e.set(t,n),n},u=function(t,e,n,r){if("a"===n&&!r)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?t!==e||!r:!e.has(t))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===n?r:"a"===n?r.call(t):r?r.value:e.get(t)};class h{call(t){return fetch(t)}}class d{constructor(t,e,n){o.set(this,void 0),i.set(this,void 0),a.set(this,void 0),s(this,o,t,"f"),this.graph=e,s(this,a,n,"f")}api(t,e,n){var r;return c(this,void 0,void 0,(function*(){const o=this.makeRequest(t,e,n),c=yield u(this,a,"f").call(o);if(c.redirected){const t=/(https:\/\/peer-\d+.*?:\d+)\/.*/,e=c.url.match(t);2==(null==e?void 0:e.length)&&s(this,i,e[1],"f")}switch(c.status){case 200:break;case 500:case 400:throw new Error(null!==(r="Error: "+(yield c.json()).message)&&void 0!==r?r:"HTTP "+c.status);case 429:throw new Error("Too many requests, try again in a minute.");case 401:throw new Error("Invalid token or token doesn't have enough privileges.");case 503:throw new Error("HTTP Status: 503. Your graph is not ready yet for a request, please retry in a few seconds.");default:throw new Error(c.statusText)}return c}))}makeRequest(t,e="POST",a){var c;const s=null!==(c=u(this,i,"f"))&&void 0!==c?c:u(d,n,"f",r);return new Request(s+t,{method:e,mode:"cors",cache:"no-cache",body:JSON.stringify(a),headers:{"Content-Type":"application/json; charset=utf-8",Authorization:`Bearer ${u(this,o,"f")}`,"x-authorization":`Bearer ${u(this,o,"f")}`}})}}function l(t,e,n){return c(this,void 0,void 0,(function*(){const r=`/api/graph/${t.graph}/q`;let o;o=n?{query:e,args:n}:{query:e};const i=yield t.api(r,"POST",o),{result:a}=yield i.json();return a}))}function p(t,e,n){return c(this,void 0,void 0,(function*(){const r=`/api/graph/${t.graph}/pull`,o={eid:n,selector:e},i=yield t.api(r,"POST",o),{result:a}=yield i.json();return a}))}function f(t,e){return c(this,void 0,void 0,(function*(){e.action="create-block";const n=`/api/graph/${t.graph}/write`;return(yield t.api(n,"POST",e)).ok}))}function g(t,e){return c(this,void 0,void 0,(function*(){e.action="move-block";const n=`/api/graph/${t.graph}/write`;return(yield t.api(n,"POST",e)).ok}))}function w(t,e){return c(this,void 0,void 0,(function*(){e.action="update-block";const n=`/api/graph/${t.graph}/write`;return(yield t.api(n,"POST",e)).ok}))}function v(t,e){return c(this,void 0,void 0,(function*(){e.action="delete-block";const n=`/api/graph/${t.graph}/write`;return(yield t.api(n,"POST",e)).ok}))}function y(t,e){return c(this,void 0,void 0,(function*(){e.action="create-page";const n=`/api/graph/${t.graph}/write`;return(yield t.api(n,"POST",e)).ok}))}function m(t,e){return c(this,void 0,void 0,(function*(){e.action="update-page";const n=`/api/graph/${t.graph}/write`;return(yield t.api(n,"POST",e)).ok}))}function k(t,e){return c(this,void 0,void 0,(function*(){e.action="delete-page";const n=`/api/graph/${t.graph}/write`;return(yield t.api(n,"POST",e)).ok}))}function T(t,e){return c(this,void 0,void 0,(function*(){e.action="batch-actions";const n=`/api/graph/${t.graph}/write`,r=yield t.api(n,"POST",e);return yield r.json()}))}function b(t){return null==t.httpClient&&(t.httpClient=new h),new d(t.token,t.graph,t.httpClient)}n=d,o=new WeakMap,i=new WeakMap,a=new WeakMap,r={value:"https://api.roamresearch.com"};var P=e.$C,$=e.DM;chrome.runtime.onInstalled.addListener((function(){chrome.contextMenus.create({id:"sendToRoam",title:"Send to Roam Research",contexts:["selection"]})})),chrome.contextMenus.onClicked.addListener((async function(t,e){if("sendToRoam"===t.menuItemId){const e={text:t.selectionText,url:t.pageUrl};await async function(t){let e;const n=new Date,r={action:"batch-actions",actions:[{action:"create-block",location:{"parent-uid":`${("0"+(n.getMonth()+1)).slice(-2)}-${("0"+n.getDate()).slice(-2)}-${n.getFullYear()}`,order:"last"},block:{string:"#inbox",uid:-1}},{action:"create-block",location:{"parent-uid":-1,order:"last"},block:{string:t.text,uid:-2}},{action:"create-block",location:{"parent-uid":-2,order:"last"},block:{string:`Source::${t.url}`}}]};chrome.storage.sync.get(["graphName","graphEditToken"],(function(t){if(!t.graphName||!t.graphEditToken)throw alert("Both Graph Name and Graph Edit Token must be set in the extension settings."),new Error("Both Graph Name and Graph Edit Token must be set in the extension settings.");console.log("Values currently are "+t.graphName+" and "+t.graphEditToken),e=$({token:t.graphEditToken,graph:t.graphName}),console.log("graph",e),P(e,r)}))}(e)}}))})();